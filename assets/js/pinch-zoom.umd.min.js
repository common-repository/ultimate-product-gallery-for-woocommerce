!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var i={};e(i),t.PinchZoom=i}}(this,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},writable:!0,configurable:!0}),"function"!=typeof Array.from&&(Array.from=function(t){return[].slice.call(t)});var e=function(t,e){var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!1),t.dispatchEvent(i)},i=function(){var t=function(t,e){this.el=t,this.zoomFactor=1,this.lastScale=1,this.offset={x:0,y:0},this.initialOffset={x:0,y:0},this.options=Object.assign({},this.defaults,e),this.setupMarkup(),this.bindEvents(),this.update(),this.isImageLoaded(this.el)&&(this.updateAspectRatio(),this.setupOffsets()),this.enable()},i=function(t,e){return t+e};t.prototype={defaults:{tapZoomFactor:2,zoomOutFactor:1.3,animationDuration:300,maxZoom:4,minZoom:.5,draggableUnzoomed:!0,lockDragAxis:!1,setOffsetsOnce:!1,use2d:!0,zoomStartEventName:"pz_zoomstart",zoomUpdateEventName:"pz_zoomupdate",zoomEndEventName:"pz_zoomend",dragStartEventName:"pz_dragstart",dragUpdateEventName:"pz_dragupdate",dragEndEventName:"pz_dragend",doubleTapEventName:"pz_doubletap",verticalPadding:0,horizontalPadding:0},handleDragStart:function(t){e(this.el,this.options.dragStartEventName),this.stopAnimation(),this.lastDragPosition=!1,this.hasInteraction=!0,this.handleDrag(t)},handleDrag:function(t){var e=this.getTouches(t)[0];this.drag(e,this.lastDragPosition),this.offset=this.sanitizeOffset(this.offset),this.lastDragPosition=e},handleDragEnd:function(){e(this.el,this.options.dragEndEventName),this.end()},handleZoomStart:function(t){e(this.el,this.options.zoomStartEventName),this.stopAnimation(),this.lastScale=1,this.nthZoom=0,this.lastZoomCenter=!1,this.hasInteraction=!0},handleZoom:function(t,e){var i=this.getTouchCenter(this.getTouches(t)),n=e/this.lastScale;this.lastScale=e,this.nthZoom+=1,this.nthZoom>3&&(this.scale(n,i),this.drag(i,this.lastZoomCenter)),this.lastZoomCenter=i},handleZoomEnd:function(){e(this.el,this.options.zoomEndEventName),this.end()},handleDoubleTap:function(t){var i=this.getTouches(t)[0],n=this.zoomFactor>1?1:this.options.tapZoomFactor,o=this.zoomFactor,s=function(t){this.scaleTo(o+t*(n-o),i)}.bind(this);this.hasInteraction||(this.isDoubleTap=!0,o>n&&(i=this.getCurrentZoomCenter()),this.animate(this.options.animationDuration,s,this.swing),e(this.el,this.options.doubleTapEventName))},computeInitialOffset:function(){this.initialOffset={x:-Math.abs(this.el.offsetWidth*this.getInitialZoomFactor()-this.container.offsetWidth)/2,y:-Math.abs(this.el.offsetHeight*this.getInitialZoomFactor()-this.container.offsetHeight)/2}},resetOffset:function(){this.offset.x=this.initialOffset.x,this.offset.y=this.initialOffset.y},isImageLoaded:function(t){return"IMG"===t.nodeName?t.complete&&0!==t.naturalHeight:Array.from(t.querySelectorAll("img")).every(this.isImageLoaded)},setupOffsets:function(){this.options.setOffsetsOnce&&this._isOffsetsSet||(this._isOffsetsSet=!0,this.computeInitialOffset(),this.resetOffset())},sanitizeOffset:function(t){var e=this.el.offsetWidth*this.getInitialZoomFactor()*this.zoomFactor,i=this.el.offsetHeight*this.getInitialZoomFactor()*this.zoomFactor,n=e-this.getContainerX()+this.options.horizontalPadding,o=i-this.getContainerY()+this.options.verticalPadding,s=Math.max(n,0),a=Math.max(o,0),h=Math.min(n,0)-this.options.horizontalPadding,r=Math.min(o,0)-this.options.verticalPadding;return{x:Math.min(Math.max(t.x,h),s),y:Math.min(Math.max(t.y,r),a)}},scaleTo:function(t,e){this.scale(t/this.zoomFactor,e)},scale:function(t,i){t=this.scaleZoomFactor(t),this.addOffset({x:(t-1)*(i.x+this.offset.x),y:(t-1)*(i.y+this.offset.y)}),e(this.el,this.options.zoomUpdateEventName)},scaleZoomFactor:function(t){var e=this.zoomFactor;return this.zoomFactor*=t,this.zoomFactor=Math.min(this.options.maxZoom,Math.max(this.zoomFactor,this.options.minZoom)),this.zoomFactor/e},canDrag:function(){return this.options.draggableUnzoomed||!((t=this.zoomFactor)>(e=1)-.01&&t<e+.01);var t,e},drag:function(t,i){i&&(this.options.lockDragAxis?Math.abs(t.x-i.x)>Math.abs(t.y-i.y)?this.addOffset({x:-(t.x-i.x),y:0}):this.addOffset({y:-(t.y-i.y),x:0}):this.addOffset({y:-(t.y-i.y),x:-(t.x-i.x)}),e(this.el,this.options.dragUpdateEventName))},getTouchCenter:function(t){return this.getVectorAvg(t)},getVectorAvg:function(t){return{x:t.map(function(t){return t.x}).reduce(i)/t.length,y:t.map(function(t){return t.y}).reduce(i)/t.length}},addOffset:function(t){this.offset={x:this.offset.x+t.x,y:this.offset.y+t.y}},sanitize:function(){this.zoomFactor<this.options.zoomOutFactor?this.zoomOutAnimation():this.isInsaneOffset(this.offset)&&this.sanitizeOffsetAnimation()},isInsaneOffset:function(t){var e=this.sanitizeOffset(t);return e.x!==t.x||e.y!==t.y},sanitizeOffsetAnimation:function(){var t=this.sanitizeOffset(this.offset),e=this.offset.x,i=this.offset.y,n=function(n){this.offset.x=e+n*(t.x-e),this.offset.y=i+n*(t.y-i),this.update()}.bind(this);this.animate(this.options.animationDuration,n,this.swing)},zoomOutAnimation:function(){if(1!==this.zoomFactor){var t=this.zoomFactor,e=this.getCurrentZoomCenter(),i=function(i){this.scaleTo(t+i*(1-t),e)}.bind(this);this.animate(this.options.animationDuration,i,this.swing)}},updateAspectRatio:function(){this.unsetContainerY(),this.setContainerY(this.container.parentElement.offsetHeight)},getInitialZoomFactor:function(){var t=this.container.offsetWidth/this.el.offsetWidth,e=this.container.offsetHeight/this.el.offsetHeight;return Math.min(t,e)},getAspectRatio:function(){return this.el.offsetWidth/this.el.offsetHeight},getCurrentZoomCenter:function(){var t=this.offset.x-this.initialOffset.x,e=-1*this.offset.x-t/(1/this.zoomFactor-1),i=this.offset.y-this.initialOffset.y;return{x:e,y:-1*this.offset.y-i/(1/this.zoomFactor-1)}},getTouches:function(t){var e=this.container.getBoundingClientRect(),i=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollLeft||document.body.scrollLeft,o=e.top+i,s=e.left+n;return Array.prototype.slice.call(t.touches).map(function(t){return{x:t.pageX-s,y:t.pageY-o}})},animate:function(t,e,i,n){var o=(new Date).getTime(),s=function(){if(this.inAnimation){var a=(new Date).getTime()-o,h=a/t;a>=t?(e(1),n&&n(),this.update(),this.stopAnimation(),this.update()):(i&&(h=i(h)),e(h),this.update(),requestAnimationFrame(s))}}.bind(this);this.inAnimation=!0,requestAnimationFrame(s)},stopAnimation:function(){this.inAnimation=!1},swing:function(t){return-Math.cos(t*Math.PI)/2+.5},getContainerX:function(){return this.container.offsetWidth},getContainerY:function(){return this.container.offsetHeight},setContainerY:function(t){return this.container.style.height=t+"px"},unsetContainerY:function(){this.container.style.height=null},setupMarkup:function(){var t,e;this.container=(t='<div class="pinch-zoom-container"></div>',(e=document.implementation.createHTMLDocument("")).body.innerHTML=t,Array.from(e.body.children)[0]),this.el.parentNode.insertBefore(this.container,this.el),this.container.appendChild(this.el),this.container.style.overflow="hidden",this.container.style.position="relative",this.el.style.webkitTransformOrigin="0% 0%",this.el.style.mozTransformOrigin="0% 0%",this.el.style.msTransformOrigin="0% 0%",this.el.style.oTransformOrigin="0% 0%",this.el.style.transformOrigin="0% 0%",this.el.style.position="absolute"},end:function(){this.hasInteraction=!1,this.sanitize(),this.update()},bindEvents:function(){var t=this;n(this.container,this),window.addEventListener("resize",this.update.bind(this)),Array.from(this.el.querySelectorAll("img")).forEach(function(e){e.addEventListener("load",t.update.bind(t))}),"IMG"===this.el.nodeName&&this.el.addEventListener("load",this.update.bind(this))},update:function(t){this.updatePlaned||(this.updatePlaned=!0,window.setTimeout(function(){this.updatePlaned=!1,t&&"resize"===t.type&&(this.updateAspectRatio(),this.setupOffsets()),t&&"load"===t.type&&(this.updateAspectRatio(),this.setupOffsets());var e=this.getInitialZoomFactor()*this.zoomFactor,i=-this.offset.x/e,n=-this.offset.y/e,o="scale3d("+e+", "+e+",1) translate3d("+i+"px,"+n+"px,0px)",s="scale("+e+", "+e+") translate("+i+"px,"+n+"px)",a=function(){this.clone&&(this.clone.parentNode.removeChild(this.clone),delete this.clone)}.bind(this);!this.options.use2d||this.hasInteraction||this.inAnimation?(this.is3d=!0,a(),this.el.style.webkitTransform=o,this.el.style.mozTransform=s,this.el.style.msTransform=s,this.el.style.oTransform=s,this.el.style.transform=o):(this.is3d&&(this.clone=this.el.cloneNode(!0),this.clone.style.pointerEvents="none",this.container.appendChild(this.clone),window.setTimeout(a,200)),this.el.style.webkitTransform=s,this.el.style.mozTransform=s,this.el.style.msTransform=s,this.el.style.oTransform=s,this.el.style.transform=s,this.is3d=!1)}.bind(this),0))},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}};var n=function(t,e){var i=null,n=0,o=null,s=null,a=function(t,n){if(i!==t){if(i&&!t)switch(i){case"zoom":e.handleZoomEnd(n);break;case"drag":e.handleDragEnd(n)}switch(t){case"zoom":e.handleZoomStart(n);break;case"drag":e.handleDragStart(n)}}i=t},h=function(t){2===n?a("zoom"):1===n&&e.canDrag()?a("drag",t):a(null,t)},r=function(t){return Array.from(t).map(function(t){return{x:t.pageX,y:t.pageY}})},f=function(t,e){var i,n;return i=t.x-e.x,n=t.y-e.y,Math.sqrt(i*i+n*n)},c=function(t){t.stopPropagation(),t.preventDefault()},l=!0;t.addEventListener("touchstart",function(t){e.enabled&&(l=!0,n=t.touches.length,function(t){var s=(new Date).getTime();if(n>1&&(o=null),s-o<300)switch(c(t),e.handleDoubleTap(t),i){case"zoom":e.handleZoomEnd(t);break;case"drag":e.handleDragEnd(t)}else e.isDoubleTap=!1;1===n&&(o=s)}(t))}),t.addEventListener("touchmove",function(t){if(e.enabled&&!e.isDoubleTap){if(l)h(t),i&&c(t),s=r(t.touches);else{switch(i){case"zoom":e.handleZoom(t,(n=s,o=r(t.touches),a=f(n[0],n[1]),f(o[0],o[1])/a));break;case"drag":e.handleDrag(t)}i&&(c(t),e.update())}l=!1}var n,o,a}),t.addEventListener("touchend",function(t){e.enabled&&(n=t.touches.length,h(t))})};return t}();t.default=i});